---
layout: post
title: 数据一致性
date: 2019-04-07 00:00:01
categories: 计算机
tags: 设计思想
comments: 1
excerpt: 数据一致性以及过度依赖数据库所带来的影响
typora-root-url: ..
---





## 博主生活

来日本的一个半月时间，虽然代码没有打太多，但是从代码的编写和测试部分学到一些道理。

## 正文

在以前的文章中<[配置文件-ini-yaml-toml-json-xml等比较](/配置文件-ini-yaml-toml-json-xml等比较)>，博主稍微讲述了一些数据是可以分为一维(单纯的key-value)、二维(key-value,value可为对象)和三维(key属性-key-value,key可为数组)，xml的强大正因为它拥有了三维。而今天，博主想展开类似的话题——数据库的数据多维性。

key-value（后文简称ky）数据库的表和关系数据库的表其实很类似，但是ky不存在约束，也就是一旦外界乱插入数据（垃圾数据）后，ky数据库会给应用app带来毁灭性冲击，出现bug。而对于关系数据库而言，普普通通的乱插数据一般不会给与应用app带来毁灭性冲击，因为关系数据是有类型的。（关系数据库没必要使用数组）

而再高一点维度，一般的应用app的不同表之间的数据是具有关系（不然怎么叫关系数据库），常见的关系是主键和外键。正因为拥有主键和外键，数据库可以进行横向扩展。（仍然是二维，只是现今进行了组合排列）

在二维数据库中，key是固定的，value是可变的。在三维数据库中，key属性、key的值，value都是可变的，因此key不再是固定值。

好处：

- 运行时，可以进行key的增减以及类型属性的修改

坏处：

- 表之间的拼接变得极为常见，增加了SQL的复杂度
- 性能上也会增加消耗
- 需要对数据库有清晰的理解。

博主对「需要对数据库有清晰的理解」该点进行稍微解释。关系数据库的key的属性常常为：长度、类型(字符串、整数、浮点数、日期等)、是否可为空。当关系数据库要建立三维数据库，就往往需要条件join语句进行连接，而join语句并不能完全解决上述所有属性的功能，只能解决检查「是否为空」的效果(join分为inner join、left join、right join，通过使用它们，可以达到该效果)，其余的就需要依靠外层的代码进行检查。

理论上，博主更倾向使用trigger进行外层包装。原因是：当其他人员进行测试时，不小心插入垃圾数据时，trigger就会被触发并进行检查。而相比之下，shell、java等外部语言显得有点脆弱。一旦插入一个莫名奇妙的数据时，程序员必须通过检查代码，并执行SQL进行查找原因，这显得有点多此一举。

我们常说在长时间时候框架后，我们会想尝试在框架的基础上扩展；在不使用框架时，我们搭建出来的代码最终也往往形成一个框架。框架的形成就相当于我们为将每一个人放到单独的房间里，大家都不可能互相接触（物理上）；而没框架时，相当于我们被放到一个操场里，有人告诉我们彼此应该保持一米远，要自觉遵守。

至于哪一种是更为良好的呢？这个问题有点像「有人问，没有单元测试，你如何保证你的代码是正确的？」再换种日常点的提问「你如何保证你打的疫苗不是假疫苗？」....这看似是信任问题，但实质上是信息不对称。

回到coding上，博主所在的现场并不是每一个人都了解业务，所以博主偏向于「不信任」的一方，认为使用trigger更为良好。（毕竟博主也不想看完所有样式书....）