---
layout: post
title: 1.SSH命令基础用法与示例
tags: Linux-Network
comments: 1
excerpt: SSH命令基础用法示例
typora-root-url: ..\..\..\..
typora-copy-images-to: ..\..\..\..\assets\blog_res
---



## Local Port Forwarding

场景1：

> 组长：我们在AWS云上部署了一个MySQL数据库，但是出于安全考虑，我们只允许云里面的应用服务访问这个数据库。
>
> 鸦鸦：那我们开发阶段，要怎么访问这个数据库？
>
> 组长：我们开发和产品的环境是不同，数据库也是不同的，因此开发阶段不需要太严格，可以让云上的一个 EC2 虚拟服务器开启 SSH 服务器功能，然后我们公司用一台电脑，Local Forwarding 云上SSH服务器，并且暴露出来，其他人就可以使用到数据库了。
>
> （实际上，AWS不需要这样做，AWS可以使用VPN或者其他功能暴露云上服务。此处仅仅简单举例）

示例一

```bash
# remote server的IP地址为:192.168.0.156
# 存在一个服务: 127.0.0.1:4566
$ curl 127.0.0.1:4566
{"status": "running"}
```

```bash
# 我们对remote server进行Local Forwarding后，
# 我们可以访问本地的4567端口。
$ ssh -L 4567:127.0.0.1:4566 xiaojie@192.168.0.156
$ curl localhost:4567
{"status": "running"}

# 本地主机为192.168.0.175,
# 我们对remote server进行行Local Forwarding,并暴露到0.0.0.0端口，
# 我们发现可以访问192.168.0.175。
$ ssh -L 0.0.0.0:4567:127.0.0.1:4566 xiaojie@192.168.0.156
$ curl 192.168.0.175:4567
{"status": "running"}
```

示例二

```bash
# remote server的IP地址是192.168.0.156
# 存在一个服务，暴露了端口4566
$ curl 192.168.0.156:4566
{"status": "running"}
```

```bash
# 我们对remote server进行Local Forwarding后，
# 证明了：remote server可以作为一个跳转服务器，帮我们访问remote server可以访问到的所有网站。
$ ssh -L 4567:192.168.0.156:4566 xiaojie@192.168.0.156
$ curl localhost:4567
{"status": "running"}
```

## Remote Port Forwarding

场景1：

> 公司内部有一套共同使用的开发版本的服务。而某一天，服务2升级了，接着服务1发生了问题。
>
> 组长：鸦鸦，服务1好像有问题，你去看看怎么回事。
>
> 鸦鸦：emmm... 好像是服务1向服务2发送了一个请求，服务2回了一个错误的结果。
>
> 组长：那你停掉服务2，并且 remote port forward 上一个版本的服务2给服务1吧，看看是不是服务2升级了造成错误。

示例一

```bash
# 主机A 使用 PyCharm启动了一个Django（Web页面），端口为8000
$ curl http://127.0.0.1:8000/
<!doctype html>
....

# 主机A 让 主机B（192.168.0.156）
$ ssh -R 8888:127.0.0.1:8000 xiaojie@192.168.0.156
xiaojie@192.168.0.156's password:
...

# 登录成功后，
# 主机B的8888端口也能使用Django服务。
$ curl http://127.0.0.1:8888/
<!doctype html>
....

# 证明了主机B可以访问到Django
```

示例二

默认情况下，我们需要修改下面的配置：

```bash
sudo sed -i '/^GatewayPorts/d' /etc/ssh/sshd_config 
echo 'GatewayPorts clientspecified' | sudo tee -a /etc/ssh/sshd_config
sudo service sshd restart
```

才能让我们访问到 `192.168.0.156`。

```bash
ssh -R 0.0.0.0:8888:127.0.0.1:8000 xiaojie@192.168.0.156
$ curl http://192.168.0.156:8888/
<!doctype html>
...
```

参考

- [SSH原理与运用（二）：远程操作与端口转发](http://www.ruanyifeng.com/blog/2011/12/ssh_port_forwarding.html)

### 