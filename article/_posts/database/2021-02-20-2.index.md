---
layout: post
title: 2.Index
date: 2021-02-28 00:00:02
tags: [database]
comments: 1
excerpt: å…³äºä¸»é”®(Primary Key)çš„æ¢è®¨ã€‚
typora-root-url: ..
---

## Storage engine

ç´¢å¼•æœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼/å¼•æ“ï¼šHash Indexã€B-Treeã€‚å‰è€…åªæœ‰å½“è¡¨æ ¼æ˜¯ä»¥å†…å­˜å½¢å¼è¿è¡Œæ—¶ï¼Œæ‰èƒ½è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸å¸¸æ¢è®¨çš„ç´¢å¼•æ˜¯B-Treeä¸ºåŸºç¡€çš„ç´¢å¼•ã€‚

### Hash Index

MySQLå®˜æ–¹æ˜¯è¿™æ ·æè¿°Hash indexçš„ã€‚<sup>[[mysql]](https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_hash_index)</sup> 

> A type of index intended for queries that use equality operators, rather than range operators such as greater-than or `BETWEEN`. **It is available for [`MEMORY`](https://dev.mysql.com/doc/refman/8.0/en/memory-storage-engine.html) tables**. Although hash indexes are the default for [`MEMORY`](https://dev.mysql.com/doc/refman/8.0/en/memory-storage-engine.html) tables for historic reasons, that storage engine also <u>supports</u> B-tree indexes, which are often a better choice for general-purpose queries.
>
> MySQL includes a variant of this index type, the adaptive hash index, that is constructed automatically for [`InnoDB`](https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html) tables if needed based on runtime conditions.
>

### B-Tree

MySQLå®˜æ–¹æ˜¯è¿™æ ·æè¿°B-Treeçš„ã€‚<sup>[[mysql]](https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_b_tree)</sup> 

> A tree data structure that is **popular** for use in database indexes. The structure is kept sorted at all times, enabling fast lookup for exact matches (equals operator) and ranges (for example, greater than, less than, and `BETWEEN` operators). This type of index is available for most storage engines, such as [`InnoDB`](https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html) and [`MyISAM`](https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html).
>
> Because B-tree nodes can have many children, a B-tree is not the same as a binary tree, which is limited to 2 children per node.
>
> Contrast with **hash index**, which is only available in the [`MEMORY`](https://dev.mysql.com/doc/refman/8.0/en/memory-storage-engine.html) storage engine. The `MEMORY` storage engine can also use B-tree indexes, and you should choose B-tree indexes for `MEMORY` tables if some queries use range operators.
>
> The use of the term B-tree is intended as a reference to the general class of index design. B-tree structures used by MySQL storage engines may be regarded as variants due to sophistications not present in a classic B-tree design. For related information, refer to the `InnoDB` Page Structure [Fil Header](https://dev.mysql.com/doc/internals/en/innodb-fil-header.html) section of the [MySQL Internals Manual](https://dev.mysql.com/doc/internals/en/index.html).
>
> See Also [hash index](https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_hash_index).

B-Tree çš„ç‰¹ç‚¹æ˜¯æ ¹æ®ç£ç›˜ç»“æ„è€Œé‡èº«åˆ¶ä½œçš„æ•°æ®ç»“æ„ã€‚é€‚åˆèŒƒå›´æŸ¥æ‰¾ã€‚å½“éšæœºæ’å…¥æ•°é‡è¿‡å¤§æ—¶ï¼Œæ ‘çš„å¹³è¡¡å°†ä¼šè¢«æ‰“ç ´ï¼Œæ­¤æ—¶æ ‘å°†ä¼šé‡æ–°è°ƒæ•´ç»“æ„ï¼Œè°ƒæ•´ç»“æ„å°†ä¼šå¸¦æ¥æ¶ˆè€—ã€‚

## For query

B-Tree æœ‰ç´¢å¼•æœ‰ä¸¤ç§ï¼šComposite Indexã€Single indexã€‚MySQL åœ¨ä½¿ç”¨è‹¥å¹²ä¸ª Single index è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¼šé€šè¿‡ Index Merge è¿›è¡Œä¼˜åŒ–æŸ¥è¯¢ã€‚

### Composite Index

```mysql
CREATE TABLE test (
    id         INT NOT NULL,
    last_name  CHAR(30) NOT NULL,
    first_name CHAR(30) NOT NULL,
    PRIMARY KEY (id),
    INDEX name (last_name,first_name)  # << Composite Index
);
```

> A multiple-column index can be considered a sorted array, the rows of which contain values that are created by concatenating the values of the indexed columns.

ç”±äºå¤šåˆ—ç´¢å¼•ï¼ˆè”åˆç´¢å¼•ï¼‰æ˜¯ä¸€ä¸ªæ’åˆ—å¥½çš„æ•°ç»„ï¼Œå¤šåˆ—çš„å€¼åˆ™ä¸ºæ•°ç»„çš„å…ƒç´ ã€‚å› ä¸ºè¯¥æ•°ç»„æ˜¯å·²ç»**æ’åºå¥½çš„**ï¼Œå› æ­¤ï¼Œåªèƒ½æ˜¯éµå¾ªæœ€å·¦ä¼˜å…ˆåŸåˆ™ï¼ˆleftmost principleï¼‰  <sup>[[mysql]](https://dev.mysql.com/doc/refman/8.0/en/multiple-column-indexes.html)</sup>

```bash
# æœ‰æ•ˆæ£€ç´¢
A
A,B
A,B,C

# æ— æ•ˆ
A,C
```

### Index Merge

ç´¢å¼•èåˆï¼ˆIndex Mergeï¼‰æ˜¯å°†è‹¥å¹²ä¸ªç´¢å¼•çš„ç»“æœé›†è¿›è¡Œç»„åˆã€‚Index Merge æœ‰ä¸‰ç§ç®—æ³•ï¼š<sup>[[mysql]](https://dev.mysql.com/doc/refman/8.0/en/index-merge-optimization.html)</sup> 

- Intersection äº¤é›†

- Union å¹¶é›†
- Sort-Union æ’åºåçš„å¹¶é›†

### composite index vs index merge

å¦‚æœ Index Merge å’Œ Composite Index ä½¿ç”¨çš„å­—æ®µç›¸åŒï¼Œé‚£ä¹ˆä¸¤è€…çš„ç£ç›˜ç©ºé—´å ç”¨å‡ ä¹ä¸€è‡´ï¼Œå·®å¼‚ä¸ºï¼š

- Composite Index é‡Œçš„å­—æ®µæ˜¯æŒ‰ä¸€å®šé¡ºåºæ’åºçš„ã€‚å¦‚æœæŸ¥è¯¢è¯­å¥çš„ä¸éµå¾ª **å·¦ä¼˜å…ˆåŸåˆ™** ï¼Œé‚£ä¹ˆ Composite Index å°†æ— æ³•ç”Ÿæ•ˆã€‚
- Index Merge æ˜¯å°†è‹¥å¹²ä¸ªç´¢å¼•æŸ¥è¯¢ç»“æœè¿›è¡Œç»“åˆï¼Œé‚£ä¹ˆ Index Merge è°ƒç”¨**ç´¢å¼•æ•°**ä¸ªçº¿ç¨‹ï¼Œè€Œ Composite Index çš„ç‰©ç†ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œå› æ­¤ä»…ä»…ä¼šè°ƒç”¨**ä¸€ä¸ª**çº¿ç¨‹ã€‚

å› æ­¤ï¼š

- Index Merge çš„æŸ¥è¯¢æ—¶é—´å–å†³äºè€—æ—¶æœ€é•¿çš„çº¿ç¨‹ã€‚Composite Index æ˜¯å¯ä»¥çœ‹ä½œæ˜¯å¾ªç¯æŸ¥è¯¢ï¼Œä¼šæ ¹æ®ç¬¬ä¸€ä¸ªç´¢å¼•å­—æ®µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åå†ä½¿ç”¨ç¬¬äºŒä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™æ ·å¾ªç¯ä¸‹å»ï¼Œè€Œä¸”ç¬¬ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœé›†å°†ä¼šå½±å“åˆ°ç¬¬äºŒä¸ªæŸ¥è¯¢çš„é€Ÿåº¦ã€‚Composite Index å¯ä»¥è¯´è€—æ—¶å–å†³äºä½äºå‰é¢å­—æ®µçš„æ•ˆç‡ã€‚

## External LinkğŸ”—

- [MySQL ä¸­æ–‡æ–‡æ¡£](https://www.docs4dev.com/docs/zh/mysql/5.7/reference/index-btree-hash.html)